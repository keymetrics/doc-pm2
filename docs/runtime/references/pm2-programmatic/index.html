<!DOCTYPE html>

<html class="runtime-page">

  <head>
    <meta charset="UTF-8">
    <title>Document</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="description" content="Description">
    <!-- <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96"> -->
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <link href="/doc-pm2/assets/img/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png">
    <link rel=“prefetch” href="https://fonts.googleapis.com/css?family=Roboto:400,500">
    <link rel="stylesheet" href="/doc-pm2/assets/css/styles.css">
    <link rel="stylesheet" href="/doc-pm2/assets/css/normalize.css">
    <link rel="stylesheet" href="/doc-pm2/assets/css/bundle.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css">
    <link rel="stylesheet" href="//unpkg.com/gitalk/dist/gitalk.css">
</head>
  <body class="test ready sticky">
      <div class="section header-section">
    <div class=" header-container">
        <div class="PM2_logo_wrapper">
            <a class="logo-container link">
                <div class="PM2_logo"></div>
            </a>
        </div>
        <div class="PM2_search search-wrapper">
            <span class="algolia-autocomplete" style="position: relative; display: inline-block; direction: ltr;"><input class="search_input ds-input" placeholder="Search documentation..." autocomplete="off" spellcheck="false" role="combobox" aria-autocomplete="list" aria-expanded="false" aria-owns="algolia-autocomplete-listbox-0" dir="auto" style="position: relative; vertical-align: top;"><pre aria-hidden="true" style="position: absolute; visibility: hidden; white-space: pre; font-family: Saira, sans-serif; font-size: 18px; font-style: normal; font-variant: normal; font-weight: 400; word-spacing: 0px; letter-spacing: normal; text-indent: 0px; text-rendering: auto; text-transform: none;"></pre><span class="ds-dropdown-menu" role="listbox" id="algolia-autocomplete-listbox-0" style="position: absolute; top: 100%; z-index: 100; display: none; left: 0px; right: auto;"><div class="ds-dataset-1"></div></span></span>
            <div class="PM2_search_icon"><i class="fas fa-search"></i></div>
            <div id="hits" class="algolia-results">
                <!-- Hits widget will appear here -->
            </div>
        </div>
    </div>
</div>
      <main>
          <aside class="sidebar">
    <div class="sidebar_2_wrapper">
        <div class="sidebar_2">
            <a href="/doc-pm2/runtime/overview" data-page="runtime-page">
                <div class="sidebar_2_item sidebar_2_item_runtime">
                    <img class="sidebar_2_item__image" src="/doc-pm2/assets/static/pm2-logo-r.png">
                    <div class="sidebar_2_item__text">Runtime</div>
                </div>
            </a>
            <a href="/doc-pm2/monitoring/overview" data-page="monitoring-page">
                <div class="sidebar_2_item sidebar_2_item_monitoring">
                    <img class="sidebar_2_item__image" src="/doc-pm2/assets/static/pm2-logo-m.png">
                    <div class="sidebar_2_item__text">Monitoring</div>
                </div>
            </a>
            <a href="/doc-pm2/enterprise/overview" data-page="enterprise-page">
                <div class="sidebar_2_item sidebar_2_item_enterprise">
                    <img class="sidebar_2_item__image" src="/doc-pm2/assets/static/pm2-logo-e.png">
                    <div class="sidebar_2_item__text">Enterprise</div>
                </div>
            </a>
        </div>
        <div class="main_content">
        </div>
    </div>
    <div class="sidebar-nav">

    <ul id="acc">
    
    
    
    
        <li class="">
            <a href="/doc-pm2/runtime/overview/">Overview</a>
            
        </li>
    
    
    
        <li class="">
            <a href="/doc-pm2/runtime/quick-start/">Quick Start</a>
            
        </li>
    
    
    
        <li class="">
            <a href="/doc-pm2/runtime/guide/">Guide</a>
            
                
            
        </li>
    
    
    
        <li class="">
            <a href="/doc-pm2/runtime/production-best-practices/">Best Practices</a>
            
                
            
        </li>
    
    
    
        <li class="">
            <a href="/doc-pm2/runtime/integration/">Integration</a>
            
                
            
        </li>
    
    
    
        <li class="active">
            <a href="/doc-pm2/runtime/references/">References</a>
            
                
                    <ul>
                        
                        
                        <li class=""><a href="/doc-pm2/runtime/references/ecosystem-file/">Ecosystem File</a></li>
                        
                        
                        <li class=""><a href="/doc-pm2/runtime/references/pm2-cli/">CLI</a></li>
                        
                        
                        <li class="active"><a href="/doc-pm2/runtime/references/pm2-programmatic/">Programmatic</a></li>
                        
                    </ul>
                
            
        </li>
    
    </ul>

    </div>
</aside>
          <section class="content">
              <div class="markdown-section gettings_started_block topBlock">
    <p style="display: initial;">Getting started with PM2<span class="runtime_block gettings_started_block_span">Runtime</span><span class="monitoring_block gettings_started_block_span">Monitoring</span><span class="enterprise_block gettings_started_block_span">Enterprise</span></p>
</div>
              <article id="main" class="markdown-section">
                  <div class="edit-page">
  <a rel="noopener" class="edit-page__text" target="_blank" href="http://github.com/keymetrics/doc-pm2/blob/master/_i18n/en/runtime/references/pm2-programmatic.md">Edit Page</a>
</div>
                   <h1 id="pm2-api">PM2 API</h1>

<p>pm2 can also be used programmatically, meaning that you can embed a process manager directly in your code, spawn processes, keep them alive even if the main script is exited.</p>

<hr />

<h2 id="simple-example">Simple example</h2>

<p>This example shows you how to start app.js with some configuration attributes. Elements passed to start are the same than those you can declare in an ecosystem file:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install pm2 <span class="nt">--save</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">pm2</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'pm2'</span><span class="p">)</span>

<span class="nx">pm2</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  <span class="p">}</span>
  
  <span class="nx">pm2</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span>
    <span class="na">script</span><span class="p">:</span> <span class="s1">'app.js'</span><span class="p">,</span>
  <span class="p">},</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">apps</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">pm2</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">throw</span> <span class="nx">err</span> <span class="p">}</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div>

<p>?&gt; If your script does not exit by itself, make sure you call <code class="highlighter-rouge">pm2.disconnect()</code>.</p>

<hr />

<h2 id="programmatic-api">Programmatic API</h2>

<p><strong><code class="highlighter-rouge">pm2.connect(errback)</code> or <code class="highlighter-rouge">pm2.connect(noDaemonMode, errback)</code></strong></p>
<ul>
  <li><code class="highlighter-rouge">noDaemonMode</code> - (Default: false) If true is passed for the first argument, pm2 will not be run as a daemon and will die when the related script exits. If pm2 is already running, your script will link to the existing daemon but will die once your process exits.</li>
  <li><code class="highlighter-rouge">errback(error)</code> - Called when finished connecting to or launching the pm2 daemon process.</li>
</ul>

<p>Either connects to a running pm2 daemon (“God”) or launches and daemonizes one. Once launched, the pm2 process will keep running after the script exits.</p>

<p><strong><code class="highlighter-rouge">pm2.disconnect()</code></strong></p>

<p>Disconnects from the pm2 daemon.</p>

<p><strong><code class="highlighter-rouge">pm2.killDaemon(errback)</code></strong></p>

<p>Kills the pm2 daemon (same as <code class="highlighter-rouge">pm2 kill</code>). Note that when the daemon is killed, all its processes are also killed. Also note that you still have to explicitly disconnect from the daemon even after you kill it.</p>

<p><strong><code class="highlighter-rouge">pm2.start(options, errback)</code></strong>
<strong><code class="highlighter-rouge">pm2.start(jsonConfigFile, errback)</code></strong>
<strong><code class="highlighter-rouge">pm2.start(script, errback)</code></strong>
<strong><code class="highlighter-rouge">pm2.start(script, options, errback)</code></strong>
<strong><code class="highlighter-rouge">pm2.start(script, jsonConfigFile, errback)</code></strong></p>

<ul>
  <li><code class="highlighter-rouge">script</code> - The path of the script to run.</li>
  <li><code class="highlighter-rouge">jsonConfigFile</code> - The path to a JSON file that can contain the same options as the <code class="highlighter-rouge">options</code> parameter.</li>
  <li><code class="highlighter-rouge">errback(err,proc)</code> - An errback called when the <code class="highlighter-rouge">script</code> has been started. The <code class="highlighter-rouge">proc</code> parameter will be a <a href="https://github.com/soyuka/pm2-notify#templating">pm2 process object</a>.</li>
  <li><code class="highlighter-rouge">options</code> - An object with the following options (additional descriptions of these options are <a href="http://pm2.keymetrics.io/docs/usage/pm2-doc-single-page/#graceful-reload">here</a>):</li>
</ul>

<p><strong><code class="highlighter-rouge">pm2.stop(process, errback)</code></strong>
<strong><code class="highlighter-rouge">pm2.restart(process, errback)</code></strong> 
<strong><code class="highlighter-rouge">pm2.delete(process, errback)</code></strong>
<strong><code class="highlighter-rouge">pm2.reload(process, errback)</code></strong></p>

<ul>
  <li><code class="highlighter-rouge">process</code> - Can either be the <code class="highlighter-rouge">name</code> as given in the <code class="highlighter-rouge">pm2.start</code> <code class="highlighter-rouge">options</code>, a process id, or the string “all” to indicate that all scripts should be restarted.</li>
  <li><code class="highlighter-rouge">errback(err, proc)</code></li>
</ul>

<p><strong><code class="highlighter-rouge">pm2.list(errback)</code></strong></p>

<ul>
  <li><code class="highlighter-rouge">errback(err, processDescriptionList)</code> - The <code class="highlighter-rouge">processDescriptionList</code> parameter will contain a list of <code class="highlighter-rouge">processDescription</code> objects as defined under <code class="highlighter-rouge">pm2.describe</code>.</li>
</ul>

<p><strong><code class="highlighter-rouge">pm2.describe(process,errback)</code></strong></p>

<ul>
  <li><code class="highlighter-rouge">errback(err, processDescription)</code></li>
  <li><code class="highlighter-rouge">processDescription</code> - An object with information about the process. Contains the properties:
    <ul>
      <li><code class="highlighter-rouge">name</code> - The name given in the original <code class="highlighter-rouge">start</code> command.</li>
      <li><code class="highlighter-rouge">pid</code> - The pid of the process.</li>
      <li><code class="highlighter-rouge">pm_id</code> - The pid for the <code class="highlighter-rouge">pm2</code> God daemon process.</li>
      <li><code class="highlighter-rouge">monit</code> - An object containing:
        <ul>
          <li><code class="highlighter-rouge">memory</code> - The number of bytes the process is using.</li>
          <li><code class="highlighter-rouge">cpu</code> - The percent of CPU being used by the process at the moment.</li>
        </ul>
      </li>
      <li><code class="highlighter-rouge">pm2_env</code> - The list of path variables in the process’s environment. These variables include:
        <ul>
          <li><code class="highlighter-rouge">pm_cwd</code> - The working directory of the process.</li>
          <li><code class="highlighter-rouge">pm_out_log_path</code> - The stdout log file path.</li>
          <li><code class="highlighter-rouge">pm_err_log_path</code> - The stderr log file path.</li>
          <li><code class="highlighter-rouge">exec_interpreter</code> - The interpreter used.</li>
          <li><code class="highlighter-rouge">pm_uptime</code> - The uptime of the process.</li>
          <li><code class="highlighter-rouge">unstable_restarts</code> - The number of unstable restarts the process has been through.</li>
          <li><code class="highlighter-rouge">restart_time</code></li>
          <li><code class="highlighter-rouge">status</code> - “online”, “stopping”, “stopped”, “launching”, “errored”, or “one-launch-status”</li>
          <li><code class="highlighter-rouge">instances</code> - The number of running instances.</li>
          <li><code class="highlighter-rouge">pm_exec_path</code> - The path of the script being run in this process.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><strong><code class="highlighter-rouge">pm2.dump(errback)</code></strong></p>

<ul>
  <li><code class="highlighter-rouge">errback(err, result)</code></li>
</ul>

<p><strong><code class="highlighter-rouge">pm2.startup(platform, errback)</code></strong></p>

<ul>
  <li><code class="highlighter-rouge">errback(err, result)</code></li>
</ul>

<p><strong><code class="highlighter-rouge">pm2.flush(process, errback)</code></strong></p>

<ul>
  <li><code class="highlighter-rouge">errback(err, result)</code></li>
</ul>

<p><strong><code class="highlighter-rouge">pm2.reloadLogs(errback)</code></strong> - <em>Rotates</em> the log files. The new log file will have a higher number in it (the default format being <code class="highlighter-rouge">${process.name}-${out|err}-${number}.log</code>).</p>

<ul>
  <li><code class="highlighter-rouge">errback(err, result)</code></li>
</ul>

<p><strong><code class="highlighter-rouge">pm2.launchBus(errback)</code></strong> - Opens a message bus.</p>

<ul>
  <li><code class="highlighter-rouge">errback(err, bus)</code> - The <code class="highlighter-rouge">bus</code> will be an <a href="https://github.com/tj/axon#pubemitter--subemitter">Axon Sub Emitter</a> object used to listen to and send events.</li>
</ul>

<p><strong><code class="highlighter-rouge">pm2.sendSignalToProcessName(signal, process, errback)</code></strong></p>

<ul>
  <li><code class="highlighter-rouge">errback(err, result)</code></li>
</ul>

<hr />

<h2 id="send-message-to-processes">Send message to processes</h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// pm2-call.js:</span>
<span class="nx">pm2</span><span class="p">.</span><span class="nx">connect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">pm2</span><span class="p">.</span><span class="nx">sendDataToProcessId</span><span class="p">({</span>
    <span class="na">type</span><span class="p">:</span> <span class="s1">'process:msg'</span><span class="p">,</span>
    <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">some</span><span class="p">:</span> <span class="s1">'data'</span><span class="p">,</span>
      <span class="na">hello</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="na">id</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="na">topic</span><span class="p">:</span> <span class="s1">'some topic'</span>
  <span class="p">},</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="p">})</span>
<span class="p">})</span>

<span class="nx">pm2</span><span class="p">.</span><span class="nx">launchBus</span><span class="p">((</span><span class="nx">err</span><span class="p">,</span> <span class="nx">bus</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">pm2_bus</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'process:msg'</span><span class="p">,</span> <span class="p">(</span><span class="nx">packet</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">packet</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">success</span><span class="p">.</span><span class="nx">should</span><span class="p">.</span><span class="nx">eql</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
    <span class="nx">packet</span><span class="p">.</span><span class="nx">process</span><span class="p">.</span><span class="nx">pm_id</span><span class="p">.</span><span class="nx">should</span><span class="p">.</span><span class="nx">eql</span><span class="p">(</span><span class="nx">proc1</span><span class="p">.</span><span class="nx">pm2_env</span><span class="p">.</span><span class="nx">pm_id</span><span class="p">)</span>
    <span class="nx">done</span><span class="p">()</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// pm2-app.js:</span>
<span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'message'</span><span class="p">,</span> <span class="p">(</span><span class="nx">packet</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">process</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
    <span class="na">type</span><span class="p">:</span> <span class="s1">'process:msg'</span><span class="p">,</span>
    <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
     <span class="na">success</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
 <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div>



              </article>
              <footer class="markdown-section copyright">
    <p>© 2018 Keymetrics</p>
    <ul id="footer">
        <li><a href="javascript:void(0);">Terms of Use</a></li>
        <li><a href="javascript:void(0);">Privacy Policy</a></li>

        <!-- Adds links to other languages on the post -->
        
          
        
          
            
              <li><p class="footer-list">Language: <a href="/doc-pm2/ch/runtime/references/pm2-programmatic/" >Chinese (中文版)</a></p></li>
            

            

            

          
        
    </ul>
  </footer>



          </section>

      </main>
  </body>
  <script src="https://unpkg.com/clipboard@2.0.0/dist/clipboard.min.js" type="text/javascript"></script>
  <script src="https://unpkg.com/prismjs@1.13.0/prism.js" type="text/javascript"></script>
  <script src="https://unpkg.com/prismjs/components/prism-bash.min.js" type="text/javascript"></script>
  <script src="https://unpkg.com/prismjs/components/prism-markdown.min.js" type="text/javascript"></script>
  <script src="https://unpkg.com/prismjs/components/prism-nginx.min.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.10.0/js/md5.min.js" type="text/javascript"></script>
  <script src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="/doc-pm2/assets/js/prism-clipboard.js" type="text/javascript"></script>
  <!-- <script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script> -->
  <!-- <script src="/doc-pm2/assets/js/gittalk.js"></script> -->
  <script src="/doc-pm2/assets/js/keymetrics-plugins.js" type="text/javascript"></script>
  <script src="/doc-pm2/assets/js/additional.js" type="text/javascript"></script>
</html>

