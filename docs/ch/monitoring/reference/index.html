

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="description" content="Description">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <!-- <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script> -->
    <link rel="stylesheet" href="https://unpkg.com/docsify/lib/themes/vue.css">
    <link rel="stylesheet" href="https://unpkg.com/docsify-copy-code/styles.css">
    <link rel=“prefetch” href="https://fonts.googleapis.com/css?family=Roboto:400,500">
    <link rel="stylesheet" href="/assets/css/normalize.css">
    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="stylesheet" href="/assets/css/bundle.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
    <link rel="stylesheet" href="//unpkg.com/gitalk/dist/gitalk.css">
</head>

<body class="ready sticky">

    <template id="sidebar2-template">
    <div class="sidebar_2_wrapper">
        <div class="sidebar_2">
            <a href="/runtime/overview" data-page="runtime-page">
                <div class="sidebar_2_item sidebar_2_item_runtime">
                    <img class="sidebar_2_item__image" src="/assets/static/pm2-logo-r.png">
                    <div class="sidebar_2_item__text">Runtime</div>
                </div>
            </a>
            <a href="/monitoring/overview" data-page="monitoring-page">
                <div class="sidebar_2_item sidebar_2_item_monitoring">
                    <img class="sidebar_2_item__image" src="/assets/static/pm2-logo-m.png">
                    <div class="sidebar_2_item__text">Monitoring</div>
                </div>
            </a>
            <a href="/enterprise/overview" data-page="enterprise-page">
                <div class="sidebar_2_item sidebar_2_item_enterprise">
                    <img class="sidebar_2_item__image" src="/assets/static/pm2-logo-e.png">
                    <div class="sidebar_2_item__text">Enterprise</div>
                </div>
            </a>
        </div>
        <div class="main_content">
        </div>
    </div>
</template>
<div class="footer-fixed-box"></div>
<div class="section header-section">
    <div class=" header-container">
        <div class="PM2_logo_wrapper">
            <a class="logo-container link">
                <div class="PM2_logo"></div>
            </a>
        </div>
        <div class="PM2_search search-wrapper">
            <span class="algolia-autocomplete" style="position: relative; display: inline-block; direction: ltr;"><input class="search_input ds-input" placeholder="Search documentation..." autocomplete="off" spellcheck="false" role="combobox" aria-autocomplete="list" aria-expanded="false" aria-owns="algolia-autocomplete-listbox-0" dir="auto" style="position: relative; vertical-align: top;"><pre aria-hidden="true" style="position: absolute; visibility: hidden; white-space: pre; font-family: Blender, sans-serif; font-size: 18px; font-style: normal; font-variant: normal; font-weight: 400; word-spacing: 0px; letter-spacing: normal; text-indent: 0px; text-rendering: auto; text-transform: none;"></pre><span class="ds-dropdown-menu" role="listbox" id="algolia-autocomplete-listbox-0" style="position: absolute; top: 100%; z-index: 100; display: none; left: 0px; right: auto;"><div class="ds-dataset-1"></div></span></span>
            <div class="PM2_search_icon"><i class="fas fa-search"></i></div>
            <div id="hits" class="algolia-results">
                <!-- Hits widget will appear here -->
            </div>
        </div>
    </div>
</div>
<nav class="app-nav no-badge">
    <!--navbar-->
</nav>

    <!-- MAIN-CONTENT AREA -->
    <main>
        <aside class="sidebar">
    <div class="sidebar_2_wrapper">
        <div class="sidebar_2">
            <a href="/runtime/overview" data-page="runtime-page">
                <div class="sidebar_2_item sidebar_2_item_runtime">
                    <img class="sidebar_2_item__image" src="/assets/static/pm2-logo-r.png">
                    <div class="sidebar_2_item__text">Runtime</div>
                </div>
            </a>
            <a href="/monitoring/overview" data-page="monitoring-page">
                <div class="sidebar_2_item sidebar_2_item_monitoring">
                    <img class="sidebar_2_item__image" src="/assets/static/pm2-logo-m.png">
                    <div class="sidebar_2_item__text">Monitoring</div>
                </div>
            </a>
            <a href="/enterprise/overview" data-page="enterprise-page">
                <div class="sidebar_2_item sidebar_2_item_enterprise">
                    <img class="sidebar_2_item__image" src="/assets/static/pm2-logo-e.png">
                    <div class="sidebar_2_item__text">Enterprise</div>
                </div>
            </a>
        <div class="lang-selector">
          <!-- Adds links to other languages on the post -->
          
            
              
                <a href="/monitoring/reference/" >Language: English</a>
              

              

              

            
          
            
          
        </div>
        </div>
        <div class="main_content">
        </div>
    </div>
    <div class="sidebar-nav">

    <ul id="acc">
    
    
    
    
    
        <li class="">
            <a href="/ch/monitoring/overview/">Overview</a>
            
        </li>
    
    
    
    
        <li class="">
            <a href="/ch/monitoring/quick-start/">Quick Start</a>
            
        </li>
    
    
    
    
        <li class="">
            <a href="/ch/monitoring/guide/">Guide</a>
            
                
            
        </li>
    
    
    
    
        <li class="">
            <a href="/ch/monitoring/integration/">Integration</a>
            
                
            
        </li>
    
    
    
    
        <li class="">
            <a href="/ch/monitoring/reference/">References</a>
            
        </li>
    
    </ul>

    </div>
</aside>

        <section class="content">
            <div class="markdown-section gettings_started_block topBlock">
    <p style="display: initial;">Getting started with PM2<span class="runtime_block gettings_started_block_span">Runtime</span><span class="monitoring_block gettings_started_block_span">Monitoring</span><span class="enterprise_block gettings_started_block_span">Enterprise</span></p>
</div>
            <article id="main" class="markdown-section">
                 <h1 id="the-pmx-library">The PMX Library</h1>

<p>PMX is a lightweight library that allows advanced interactions with your dashboards.</p>

<ul>
  <li><strong>Expose metrics</strong> to be displayed in realtime or through history</li>
  <li><strong>Expose actions</strong> remotely triggerable from the dashboard</li>
  <li><strong>Emit exceptions</strong> like exceptions or critical issues</li>
  <li><strong>Emit events</strong> to inform about anything</li>
</ul>

<hr />

<h2 id="installation">Installation</h2>

<p>With yarn:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yarn add pmx
</code></pre></div></div>

<p>With npm:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install pmx <span class="nt">--save</span>
</code></pre></div></div>

<h3 id="pmx-intialisation">PMX intialisation</h3>

<p>Load and initialize pmx at the top level of your application.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">pmx</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'pmx'</span><span class="p">).</span><span class="nx">init</span><span class="p">({</span>
  <span class="na">errors</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">transactions</span><span class="p">:</span> <span class="kc">false</span>
  <span class="na">profiling</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="possible-issues-with-modules">Possible issues with modules:</h3>

<p>To retrieve the http latency, pmx <a href="https://github.com/keymetrics/pmx/blob/master/lib/wrapper/simple_http.js">wraps</a> the <code class="highlighter-rouge">http</code> module. If you require any module modifying the <code class="highlighter-rouge">http</code> module, the wrapper could be removed.</p>

<ul>
  <li><code class="highlighter-rouge">request-promise</code>: This module clears the node cache and requires a new clean version of the <code class="highlighter-rouge">http</code> module. To solve this require <code class="highlighter-rouge">http</code> again after requiring <code class="highlighter-rouge">request-promise</code> to get the correctly wrapped <code class="highlighter-rouge">http</code> module.</li>
</ul>

<p>Options available are:</p>

<table>
  <thead>
    <tr>
      <th>Option</th>
      <th>Description</th>
      <th>Type</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>errors</td>
      <td>Enable the Issue Dashboard</td>
      <td>boolean</td>
      <td>true</td>
    </tr>
    <tr>
      <td>transactions</td>
      <td>Enable the Transaction Tracing</td>
      <td>boolean</td>
      <td>false</td>
    </tr>
    <tr>
      <td>profiling</td>
      <td>Enable the Profiling</td>
      <td>boolean</td>
      <td>true</td>
    </tr>
    <tr>
      <td>http</td>
      <td>Enable HTTP routes logging</td>
      <td>boolean</td>
      <td>true</td>
    </tr>
    <tr>
      <td>http_latency</td>
      <td> </td>
      <td>integer</td>
      <td>200</td>
    </tr>
    <tr>
      <td>http_code</td>
      <td> </td>
      <td>integer</td>
      <td>500</td>
    </tr>
    <tr>
      <td>ignore_routes</td>
      <td>Ignore http routes with the given patterns</td>
      <td>[Regexp]</td>
      <td>[]</td>
    </tr>
    <tr>
      <td>alert_enabled</td>
      <td>Enable or disable the alert subfield in custom metrics</td>
      <td>boolean</td>
      <td>true</td>
    </tr>
    <tr>
      <td>custom_probes</td>
      <td>Auto expose JS Loop Latency and HTTP req/s as custom metrics</td>
      <td>boolean</td>
      <td>true</td>
    </tr>
    <tr>
      <td>network</td>
      <td>Network monitoring at the application level,display inbound and outbound traffic</td>
      <td>boolean</td>
      <td>false</td>
    </tr>
    <tr>
      <td>ports</td>
      <td>Shows which ports your app is listening on</td>
      <td>boolean</td>
      <td>false</td>
    </tr>
  </tbody>
</table>

<h3 id="application-level-network-traffic-monitoring--display-used-ports">Application level network traffic monitoring / Display used ports</h3>

<p>You can monitor the network usage of a specific application by adding the option <code class="highlighter-rouge">network: true</code> when initializing PMX. 
If you enable the flag <code class="highlighter-rouge">ports: true</code> when you init pmx it will show which ports your application is listening on.</p>

<p>You can find these metrics in the <strong>Custom Metrics</strong> section located in the Keymetrics Dashboard page.</p>

<p>Example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pmx.init({
  [...]
  network : true, // Allows application level network monitoring
  ports   : true  // Displays ports used by the application
});
</code></pre></div></div>

<h3 id="http-latency-analysis">HTTP latency analysis</h3>

<p>This feature enables you to monitor routes, latency and codes while being REST compliant.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pmx</span><span class="p">.</span><span class="nx">http</span><span class="p">();</span> <span class="c1">// You must do this BEFORE any require('http')</span>
</code></pre></div></div>

<p>You can also ignore some routes by passing a list of regular expressions.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pmx</span><span class="p">.</span><span class="nx">http</span><span class="p">({</span>
  <span class="na">http</span>          <span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// (Default: true)</span>
  <span class="na">ignore_routes</span> <span class="p">:</span> <span class="p">[</span><span class="sr">/socket</span><span class="se">\.</span><span class="sr">io/</span><span class="p">,</span> <span class="sr">/notFound/</span><span class="p">]</span> <span class="c1">// Ignore http routes with this pattern (Default: [])</span>
<span class="p">});</span>
</code></pre></div></div>

<p>This can alternatively be done via pmx.init().</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pmx</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
  <span class="na">http</span>          <span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// (Default: true)</span>
  <span class="na">ignore_routes</span> <span class="p">:</span> <span class="p">[</span><span class="sr">/socket</span><span class="se">\.</span><span class="sr">io/</span><span class="p">,</span> <span class="sr">/notFound/</span><span class="p">]</span> <span class="c1">// Ignore http routes with this pattern (Default: [])</span>
<span class="p">});</span>
</code></pre></div></div>

<hr />

<h2 id="custom-metrics">Custom Metrics</h2>

<p>You can then program your very own metrics to track important and relevant information. 4 differents probes are available:</p>

<ul>
  <li><strong>Simple metrics</strong>: Values that can be read instantly
    <ul>
      <li>eg. Monitor variable value</li>
    </ul>
  </li>
  <li><strong>Counter</strong>: Things that increment or decrement
    <ul>
      <li>eg. Downloads being processed, user connected</li>
    </ul>
  </li>
  <li><strong>Meter</strong>: Things that are measured as events / interval
    <ul>
      <li>eg. Request per minute for a http server</li>
    </ul>
  </li>
  <li><strong>Histogram</strong>: Keeps a resevoir of statistically relevant values biased towards the last 5 minutes to explore their distribution
    <ul>
      <li>eg. Monitor the mean of execution of a query into database</li>
    </ul>
  </li>
</ul>

<h3 id="metric-simple-value-reporting">Metric: Simple value reporting</h3>

<p>This allows to expose values that can be read instantly.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">probe</span> <span class="o">=</span> <span class="nx">pmx</span><span class="p">.</span><span class="nx">probe</span><span class="p">()</span>

<span class="c1">// Here the value function will be called each second to get the value</span>
<span class="kd">const</span> <span class="nx">metric</span> <span class="o">=</span> <span class="nx">probe</span><span class="p">.</span><span class="nx">metric</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'Realtime user'</span><span class="p">,</span>
  <span class="na">value</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">users</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="c1">// Here we are going to call valvar.set() to set the new value</span>
<span class="kd">const</span> <span class="nx">valvar</span> <span class="o">=</span> <span class="nx">probe</span><span class="p">.</span><span class="nx">metric</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'Realtime Value'</span>
<span class="p">})</span>

<span class="nx">valvar</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="counter-sequential-value-change">Counter: Sequential value change</h3>

<p>Things that increment or decrement.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">probe</span> <span class="o">=</span> <span class="nx">pmx</span><span class="p">.</span><span class="nx">probe</span><span class="p">()</span>

<span class="c1">// The counter will start at 0</span>
<span class="kd">const</span> <span class="nx">counter</span> <span class="o">=</span> <span class="nx">probe</span><span class="p">.</span><span class="nx">counter</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'Current req processed'</span>
<span class="p">});</span>

<span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Increment the counter, counter will eq 1</span>
  <span class="nx">counter</span><span class="p">.</span><span class="nx">inc</span><span class="p">()</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'end'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Decrement the counter, counter will eq 0</span>
    <span class="nx">counter</span><span class="p">.</span><span class="nx">dec</span><span class="p">()</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div>

<h3 id="meter-average-calculated-values">Meter: Average calculated values</h3>

<p>Things that are measured as events / intervals.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">probe</span> <span class="o">=</span> <span class="nx">pmx</span><span class="p">.</span><span class="nx">probe</span><span class="p">()</span>

<span class="kd">const</span> <span class="nx">meter</span> <span class="o">=</span> <span class="nx">probe</span><span class="p">.</span><span class="nx">meter</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'req/sec'</span><span class="p">,</span>
  <span class="na">samples</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="na">timeframe</span><span class="p">:</span> <span class="mi">60</span>
<span class="p">})</span>

<span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">meter</span><span class="p">.</span><span class="nx">mark</span><span class="p">()</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">({</span> <span class="na">success</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div>

<p>Options:</p>

<p><strong>Sample</strong> option is the rate unit. Defaults to <strong>1</strong> sec.
<strong>timeframe</strong> option is the timeframe over which events will be analyzed. Defaults to <strong>60</strong> sec.</p>

<h3 id="histogram">Histogram</h3>

<p>Stores a resevoir of statistically relevant values biased towards the last 5 minutes to explore their distribution.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">probe</span> <span class="o">=</span> <span class="nx">pmx</span><span class="p">.</span><span class="nx">probe</span><span class="p">()</span>

<span class="kd">const</span> <span class="nx">histogram</span> <span class="o">=</span> <span class="nx">probe</span><span class="p">.</span><span class="nx">histogram</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'latency'</span><span class="p">,</span>
  <span class="na">measurement</span><span class="p">:</span> <span class="s1">'mean'</span>
<span class="p">})</span>

<span class="kd">let</span> <span class="nx">latency</span> <span class="o">=</span> <span class="mi">0</span>

<span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">latency</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
  <span class="nx">histogram</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">latency</span><span class="p">)</span>
<span class="p">},</span> <span class="mi">100</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="common-custom-metrics-options">Common Custom Metrics options</h3>

<ul>
  <li><code class="highlighter-rouge">name</code> : The probe name as it will be displayed on the <strong>Keymetrics</strong> dashboard.</li>
  <li><code class="highlighter-rouge">agg_type</code> : This parameter is optional, it can be <code class="highlighter-rouge">sum</code>, <code class="highlighter-rouge">max</code>, <code class="highlighter-rouge">min</code>, <code class="highlighter-rouge">avg</code> (default) or <code class="highlighter-rouge">none</code>. It will impact the way the probe data are aggregated within the <strong>Keymetrics</strong> backend. Use <code class="highlighter-rouge">none</code> if this is irrelevant (eg: constant or string value).</li>
  <li><code class="highlighter-rouge">alert</code> : For <code class="highlighter-rouge">Meter</code> and <code class="highlighter-rouge">Counter</code> probes. This parameter is optional. It will create an alert object (see below).</li>
</ul>

<h3 id="alert-system-for-custom-metrics">Alert System for Custom Metrics</h3>

<p>This alert system can monitor a Probe value and launch an exception when hitting a particular value.</p>

<p>Example for a <code class="highlighter-rouge">cpu_usage</code> var:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">metric</span> <span class="o">=</span> <span class="nx">probe</span><span class="p">.</span><span class="nx">metric</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'CPU usage'</span><span class="p">,</span>
  <span class="na">value</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">cpu_usage</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="na">alert</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">mode</span><span class="p">:</span> <span class="s1">'threshold'</span><span class="p">,</span>
    <span class="na">value</span><span class="p">:</span> <span class="mi">95</span><span class="p">,</span>
    <span class="c1">// optional</span>
    <span class="na">msg</span><span class="p">:</span> <span class="s1">'Detected over 95% CPU usage'</span><span class="p">,</span>
    
    <span class="c1">//optional</span>
    <span class="na">action</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Detected over 95% CPU usage'</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="c1">//optional</span>
    <span class="na">cmp</span><span class="p">:</span> <span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">threshold</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// default check</span>
      <span class="k">return</span> <span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">threshold</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Options:</p>

<ul>
  <li><code class="highlighter-rouge">mode</code> : <code class="highlighter-rouge">threshold</code>, <code class="highlighter-rouge">threshold-avg</code>, <code class="highlighter-rouge">smart</code>.</li>
  <li><code class="highlighter-rouge">value</code> : Value that will be used for the exception check.</li>
  <li><code class="highlighter-rouge">msg</code> : String used for the exception.</li>
  <li><code class="highlighter-rouge">action</code> :  <strong>optional</strong>. Function triggered when the exception level is reached.</li>
  <li><code class="highlighter-rouge">cmp</code> : <strong>optional</strong>. Function used for exception check that takes 2 arguments.</li>
  <li><code class="highlighter-rouge">interval</code> : <strong>optional</strong>, <code class="highlighter-rouge">threshold-avg</code> mode. Sample length for monitored value (180 seconds default).</li>
  <li><code class="highlighter-rouge">timeout</code> : <strong>optional</strong>, <code class="highlighter-rouge">threshold-avg</code> mode. Time after which mean comparison starts (30 000 milliseconds default).</li>
</ul>

<hr />

<h2 id="remote-actions">Remote actions</h2>

<p>Remotely trigger functions directly from Keymetrics. These features can be found in the main Keymetrics Dashboard page under the Custom Action section.</p>

<h3 id="simple-actions">Simple actions</h3>

<p>A simple action allows to trigger a function from Keymetrics. The action command takes a function as a parameter (reply here) and needs to be called once the job is finished.</p>

<p>Example:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">pmx</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'pmx'</span><span class="p">)</span>

<span class="nx">pmx</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="s1">'db:clean'</span><span class="p">,</span> <span class="p">(</span><span class="nx">reply</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">clean</span><span class="p">.</span><span class="nx">db</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="cm">/**
     * reply() must be called at the end of the action
     */</span>
     <span class="nx">reply</span><span class="p">({</span><span class="na">success</span> <span class="p">:</span> <span class="kc">true</span><span class="p">})</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div>

<h3 id="scoped-actions">Scoped actions</h3>

<p>Scoped Actions are advanced remote actions that can also be triggered from Keymetrics.</p>

<p>Two arguments are passed to the function, data (optionnal data sent from Keymetrics) and res that allows to emit log data and to end the scoped action.</p>

<p>Example:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pmx</span><span class="p">.</span><span class="nx">scopedAction</span><span class="p">(</span><span class="s1">'long running lsof'</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">child</span> <span class="o">=</span> <span class="nx">spawn</span><span class="p">(</span><span class="s1">'lsof'</span><span class="p">,</span> <span class="p">[])</span>

  <span class="nx">child</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'data'</span><span class="p">,</span> <span class="p">(</span><span class="nx">chunk</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">chunk</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s1">'</span><span class="err">\</span><span class="s1">n'</span><span class="p">).</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">line</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">line</span><span class="p">);</span> <span class="c1">// This sends log to Keymetrics to be saved (for tracking)</span>
    <span class="p">})</span>
  <span class="p">})</span>

  <span class="nx">child</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'end'</span><span class="p">,</span> <span class="p">(</span><span class="nx">chunk</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">'end'</span><span class="p">);</span> <span class="c1">// This ends the scoped action</span>
  <span class="p">})</span>

  <span class="nx">child</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>  <span class="c1">// This reports an error to Keymetrics</span>
  <span class="p">})</span>

<span class="p">})</span>
</code></pre></div></div>

<hr />

<h2 id="emit-events">Emit Events</h2>

<p>Emit events and get historical and statistics.
This is available in the Keymetrics <strong>Events</strong> page.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">pmx</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'pmx'</span><span class="p">)</span>

<span class="nx">pmx</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">'user:register'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">user</span><span class="p">:</span> <span class="s1">'Alex registered'</span><span class="p">,</span>
  <span class="na">email</span><span class="p">:</span> <span class="s1">'thorustor@gmail.com'</span>
<span class="p">})</span>
</code></pre></div></div>

<hr />

<h2 id="issues-reports">Issues reports</h2>

<p>Once PM2 is linked to Keymetrics, you will be alerted of any uncaught exception by default.
These errors are accessible in Keymetrics <strong>Issue</strong> page.</p>

<h3 id="custom-alert-notification">Custom alert notification</h3>

<p>If you need to alert about any critical errors you can do it programmatically:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">pmx</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'pmx'</span><span class="p">)</span>

<span class="nx">pmx</span><span class="p">.</span><span class="nx">notify</span><span class="p">({</span> <span class="na">success</span> <span class="p">:</span> <span class="kc">false</span> <span class="p">})</span>

<span class="nx">pmx</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="s1">'This is an error'</span><span class="p">)</span>

<span class="nx">pmx</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'This is an error'</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="add-verbosity-to-an-alert-express-error-handler">Add Verbosity to an Alert: Express Error handler</h3>

<p>When an uncaught exception is happening you can track the routes from which it has been thrown.
To do that you have to attach the middleware <code class="highlighter-rouge">pmx.expressErrorHandler</code> at then end of your routes mounting:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">pmx</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'pmx'</span><span class="p">)</span>

<span class="c1">// All my routes</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/'</span> <span class="p">...)</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(...)</span>
<span class="c1">// All my routes</span>

<span class="c1">// Here I attach the middleware to get more verbosity on exception thrown</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">pmx</span><span class="p">.</span><span class="nx">expressErrorHandler</span><span class="p">())</span>
</code></pre></div></div>


            </article>

        </section>

        
    </main>
</body>
    <script>window.$docsify = {"basePath":"/docs","alias":{"/runtime/.*/_sidebar.md":"/runtime/_sidebar.md","/monitoring/.*/_sidebar.md":"/monitoring/_sidebar.md","/enterprise/.*/_sidebar.md":"/enterprise/_sidebar.md"},"auto2top":true,"coverpage":false,"executeScript":true,"loadSidebar":"_sidebar.md","loadNavbar":false,"mergeNavbar":false,"subMaxLevel":1,"name":"","search":false,"plugins":[],"routerMode":"history"}</script>
<!-- <script src="//unpkg.com/docsify/lib/docsify.min.js"></script> -->
<!-- <script src="/ch/assets/js/docsify.js"></script> -->
<script src="/assets/js/scripts.js" type="text/javascript"></script>
<script src="https://unpkg.com/clipboard@2.0.0/dist/clipboard.min.js" type="text/javascript"></script>
<script src="https://unpkg.com/prismjs@1.13.0/prism.js" type="text/javascript"></script>
<script src="https://unpkg.com/prismjs/components/prism-bash.min.js" type="text/javascript"></script>
<script src="https://unpkg.com/prismjs/components/prism-markdown.min.js" type="text/javascript"></script>
<script src="https://unpkg.com/prismjs/components/prism-nginx.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.10.0/js/md5.min.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="/assets/js/prism-clipboard.js" type="text/javascript"></script>
<!-- <script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script> -->
<!-- <script src="/ch/assets/js/gittalk.js"></script> -->
<script src="/assets/js/keymetrics-plugins.js" type="text/javascript"></script>
<script src="/assets/js/additional.js" type="text/javascript"></script>
</html>
